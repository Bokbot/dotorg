image: bokbot/dotorg:latest

stages:
  - build
  - test
  - deploy
  - cleanup

before_script:
  - export DISPLAY=:99.0
  - export LIGHTHOUSE_CHROMIUM_PATH="$(pwd)/chrome-linux/chrome"
  - sh -e /etc/init.d/xvfb start
  - npm explore -g lighthouse -- ./lighthouse-core/scripts/download-chrome.sh
  - mv $(npm root -g)/lighthouse/chrome-linux .
  - $LIGHTHOUSE_CHROMIUM_PATH --version


build:
  script:
    - npm run gulp build

test:
  script:
    - htmlproofer ./_site
    - cd _site && ws&
    - lighthouse http://127.0.0.1:8000 --output=json --output-path=./validate/log.json
    - node ./validate/checklog.js ./validate/log.json

deploy:
  script:
    - echo 'this is not a deploy'

cleanup:
  script:
    - echo 'this is not a cleanup'
